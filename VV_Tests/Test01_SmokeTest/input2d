// =============================================================================
// TEST 1: SMOKE TEST - SCALAR INFRASTRUCTURE
// =============================================================================
// Purpose: Verify basic scalar variable registration, I/O, and BCs
// Setup: 1×1 domain, 32×32 grid, zero velocity, Dirichlet left BC
// =============================================================================

// Physical parameters
MU = 1.0e-2
RHO = 1.0
KAPPA = 1.0e-3  // Diffusion coefficient

// Grid parameters
MAX_LEVELS = 1  // Single level only (no AMR)
N = 32          // Coarse uniform grid

// Time parameters
START_TIME = 0.0
END_TIME = 0.1   // Short test
DT_MAX = 0.001   // Small time step
CFL_MAX = 0.3

// Solver parameters
DELTA_FUNCTION = "IB_4"
CONVECTIVE_OP_TYPE = "CENTERED"
CONVECTIVE_FORM = "CONSERVATIVE"
NORMALIZE_PRESSURE = FALSE
ENABLE_LOGGING = TRUE

Main {
   log_file_name    = "test01_smoke.log"
   log_all_nodes    = FALSE
   viz_writer       = "VisIt"
   viz_dump_interval = 5
   viz_dump_dirname = "viz_test01"
   visit_number_procs_per_file = 1
}

CartesianGeometry {
   domain_boxes = [(0,0), (N-1, N-1)]
   x_lo = 0.0, 0.0
   x_up = 1.0, 1.0
   periodic_dimension = 0, 0  // NON-periodic (to test BCs)
}

GriddingAlgorithm {
   max_levels = MAX_LEVELS
   largest_patch_size {
      level_0 = 512, 512
   }
   smallest_patch_size {
      level_0 = 8, 8
   }
   efficiency_tolerance = 0.85
   combine_efficiency = 0.85
}

StandardTagAndInitialize {
   tagging_method = "GRADIENT_DETECTOR"
}

LoadBalancer {
   bin_pack_method = "SPATIAL"
   max_workload_factor = 1
}

// =============================================================================
// NAVIER-STOKES (ZERO VELOCITY FIELD)
// =============================================================================
INSStaggeredHierarchyIntegrator {
   mu = MU
   rho = RHO
   start_time = START_TIME
   end_time = END_TIME
   grow_dt = 2.0
   cfl = CFL_MAX
   dt_max = DT_MAX
   enable_logging = ENABLE_LOGGING

   // Zero velocity initialization
   num_cycles = 1
   convective_op_type = CONVECTIVE_OP_TYPE
   convective_difference_form = CONVECTIVE_FORM
   normalize_pressure = NORMALIZE_PRESSURE
}

// Velocity boundary conditions (no-slip, zero velocity)
VelocityBcCoefs_0 {
   acoef_function_0 = "1.0"
   acoef_function_1 = "1.0"
   acoef_function_2 = "1.0"
   acoef_function_3 = "1.0"

   bcoef_function_0 = "0.0"
   bcoef_function_1 = "0.0"
   bcoef_function_2 = "0.0"
   bcoef_function_3 = "0.0"

   gcoef_function_0 = "0.0"
   gcoef_function_1 = "0.0"
   gcoef_function_2 = "0.0"
   gcoef_function_3 = "0.0"
}

VelocityBcCoefs_1 {
   acoef_function_0 = "1.0"
   acoef_function_1 = "1.0"
   acoef_function_2 = "1.0"
   acoef_function_3 = "1.0"

   bcoef_function_0 = "0.0"
   bcoef_function_1 = "0.0"
   bcoef_function_2 = "0.0"
   bcoef_function_3 = "0.0"

   gcoef_function_0 = "0.0"
   gcoef_function_1 = "0.0"
   gcoef_function_2 = "0.0"
   gcoef_function_3 = "0.0"
}

// =============================================================================
// SCALAR TRANSPORT (ADVECTION-DIFFUSION)
// =============================================================================
AdvDiffHierarchyIntegrator {
   start_time = START_TIME
   end_time = END_TIME
   grow_dt = 2.0
   cfl = CFL_MAX
   dt_max = DT_MAX
   enable_logging = ENABLE_LOGGING

   num_cycles = 1
   convective_op_type = CONVECTIVE_OP_TYPE
   convective_difference_form = CONVECTIVE_FORM

   // Implicit diffusion for stability
   diffusion_time_stepping_type = "BACKWARD_EULER"
   convective_time_stepping_type = "ADAMS_BASHFORTH"

   HelmholtzHypreSolver {
      solver_type = "PFMG"
      relative_residual_tol = 1.0e-10
      max_iterations = 100
      enable_logging = FALSE
   }

   HelmholtzFACSolver {
      num_pre_sweeps = 0
      num_post_sweeps = 3
      coarse_solver_choice = "hypre"
      coarse_solver_tolerance = 1.0e-12
      coarse_solver_max_iterations = 1
      prolongation_method = "LINEAR_REFINE"
      restriction_method = "CONSERVATIVE_COARSEN"
   }
}

// =============================================================================
// SCALAR INITIAL CONDITION: C = 0 everywhere
// =============================================================================
OdorInitialConditions {
   function_0 = "0.0"
}

// =============================================================================
// SCALAR BOUNDARY CONDITIONS
// =============================================================================
// Robin BC: a*C + b*∂C/∂n = g
// Dirichlet (C=g/a): a=1, b=0, g=value
// Neumann (∂C/∂n=g/b): a=0, b=1, g=value
//
// Boundary numbering (2D):
//   0 = x_lower (left, x=0)
//   1 = x_upper (right, x=1)
//   2 = y_lower (bottom, y=0)
//   3 = y_upper (top, y=1)
// =============================================================================
OdorBcCoefs {
   // LEFT boundary (x=0): Dirichlet C = 1.0
   acoef_function_0 = "1.0"
   bcoef_function_0 = "0.0"
   gcoef_function_0 = "1.0"

   // RIGHT boundary (x=1): Neumann ∂C/∂n = 0
   acoef_function_1 = "0.0"
   bcoef_function_1 = "1.0"
   gcoef_function_1 = "0.0"

   // BOTTOM boundary (y=0): Neumann ∂C/∂n = 0
   acoef_function_2 = "0.0"
   bcoef_function_2 = "1.0"
   gcoef_function_2 = "0.0"

   // TOP boundary (y=1): Neumann ∂C/∂n = 0
   acoef_function_3 = "0.0"
   bcoef_function_3 = "1.0"
   gcoef_function_3 = "0.0"
}

// Diffusion coefficient (passed to AdvDiffIntegrator)
diffusion_coefficient = KAPPA
